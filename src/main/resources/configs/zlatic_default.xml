<?xml version="1.0"?>

<transmogrifierConfiguration>

    <global minimumVersion="4.4.0"/>

    <project name="Default Project"
             default="true"
             copyPreviousButtonVisible="false">

        <inputFileFilter patternString=".+\.(png|blob|blobs|set|summary)"
                         recursiveSearch="true"/>

        <inputFileSorter sortAlgorithm="Path"/>

        <outputDirectory fileModeReadOnly="false">
            <path path="/cephfs/zlatic_lab/pipeline/screen/tracking-results/"/>
            <renameFieldValue fieldDisplayName="Rig"/>
            <path path="/"/>
            <renameFieldValue fieldDisplayName="Drivers"/>
            <renameFieldValue fieldDisplayName="Effectors" prefix="@"/>
            <path path="/"/>
            <renameFieldValue fieldDisplayName="Protocol"/>
            <path path="/"/>
            <renameFieldValue fieldDisplayName="Date"/>
            <renameFieldValue fieldDisplayName="Time" prefix="_"/>
        </outputDirectory>

        <plugins>
        </plugins>

        <dataFields>
            <date displayName="Date"
                  required="true"
                  datePattern="yyyyMMdd">
                <sourceFileDateDefault pattern="^(\d{8})_\d{6}@.*"
                                       fromDatePattern="yyyyMMdd"
                                       toDatePattern="yyyyMMdd"/>
            </date>

            <separator value="_"/>

            <date displayName="Time"
                  required="true"
                  datePattern="HHmmss">
                <sourceFileDateDefault pattern="^\d{8}_(\d{6})@.*"
                                       fromDatePattern="HHmmss"
                                       toDatePattern="HHmmss"/>
            </date>

            <separator value="@"/>

            <validValueDBList displayName="Drivers"
                              required="true"
                              DBPath="../dbs/drivers.csv"
                              separator="_"
                              validationPattern="[a-zA-Z0-9]+">
                <sourceFileDefault pattern="^.+?@(.+?)@.*"/>
            </validValueDBList>

            <separator value="@"/>

            <validValueDBList displayName="Effectors"
                              required="true"
                              DBPath="../dbs/effectors.csv"
                              separator="_"
                              validationPattern="[a-zA-Z0-9]+">
                <sourceFileDefault pattern="^.+?@.+?@(.+?)@.*"/>
            </validValueDBList>

            <separator value="@"/>

            <text displayName="Rig"
                  required="true"
                  copyable="false"
                  pattern="^(?:BC1)|(?:BC2)|(?:BO1)|(?:BO2)(?:BO3)|(?:BO4)$">
                <sourceFileDefault pattern="^.+?@.+?@.+?@(.+?)@.*"/>
            </text>

            <separator value="@"/>

            <validValueDBList displayName="Protocol"
                              required="true"
                              DBPath="../dbs/stimulus_types.csv"
                              separator="#"
                              validationPattern="^[a-z](?=_)">
                <sourceFileDefault pattern="^.+?@.+?@.+?@.+?@(.+?)@.*"/>
            </validValueDBList>

            <separator value="@"/>

            <validValueDBList displayName="Experiment Type"
                              required="true"
                              DBPath="../dbs/experiment_types.csv"
                              validationPattern="^[a-z]+(?=_?)">
                <sourceFileDefault pattern="^.+?@.+?@.+?@.+?@.+?@(.+?)@.*"/>
            </validValueDBList>

            <separator value="@"/>

            <text displayName="Suffix" required="true" copyable="false" pattern="^_?\d{5}k$">
                <sourceFileDefault pattern=".*@(.+?)\..+$"/>
            </text>

            <fileExtension/>

        </dataFields>

    </project>

</transmogrifierConfiguration>